---
layout: single
title: "AWS 스팟 인스턴스"
date: 2025-09-24
categories:
  - AWS_SAA
tag: [AWS, SAA, EC2]
---

스팟 인스턴스는 온디맨드에 비해 최대 90%까지 할인받을 수 있다.

이 인스턴스가 어떻게 작동하는지 알아보자

- - -

## 스팟 인스턴스

먼저 스팟 인스턴스에 대해 지불 할 수 있는 최대 스팟 가격을 정의한다.

그리고 인스턴스의 스팟 가격이 우리가 정한 스팟 가격보다 낮으면 해당 인스턴스를 유지한다.

**이때 스팟 가격이 최대 가격을 초과하면 어떻게 될까**

1. 인스턴스를 중지하고 시간이 지나서 스팟 가격이 내려가게 되면 인스턴스를 다시 시작하면 된다.

2. 아니면 그냥 인스턴스를 종료하면 된다.

둘중에 하나를 **2분**안에 결정하면 된다.

![spot](/스샷%20자료실/EC2/20.png)

이런 식으로 스팟 인스턴스의 가격은 계속 바뀌지만 변동이 엄청 크지는 않다.

만약 0.05$로 최대가격을 설정해두면 인스턴스는 회수되지 않는다.


**스팟 인스턴스는 언제 사용될까**

* 배치작업 및 데이터 분석

* 장애 복원력이 뛰어난 워크로드

* 중요한 작업이나 데이터베이스에는 적합하지 않음

## 스팟 블록

만약 AWS가 스팟 인스턴스를 회수하는 것을 원하지 않으면 스팟블록을 사용하면 된다.

1~6시간동안 중단없이 해당 스팟블록을 사용할 수 있다.


## 스팟 인스턴스 요청

스팟 요청에서는 원하는 인스턴스 수, 최대 가격 및 시작 사양 등을 정한다.

또한 요청에는 두가지 유형이 있다.

1. 일회성 요청인 경우

스팟 요청이 완료되는 즉시 인스턴스가 시작된다.

그리면 스팟 요청은 사라진다.

2. 영구 요청인 경우

인스턴스가 어떤 이유로든 중지되거나 스팟 가격을 기준으로 중단된 경우

스팟 요청이 다시 실행되고 유효성이 확인되면 스팟 인스턴스가 다시 시작된다.

그래서 스팟 요청을 취소하고 그 다움에 스팟 인스턴스를 종료해야한다.

만약 스팟 인스턴스를 먼저 종료하면 AWS는 스팟 요청으로 다시 돌아가서 

'6개의 인스턴스를 원한다고 했는데 현재 인스턴스는 0개 있군'이렇게 판단해서

6개의 인스턴스를 시작할 것이다.

**따라서 스팟 인스턴스를 종료하려면 먼저 스팟 요청을 취소해야한다.**


## 스팟 플릿

Spot Fleet은 여러 인스턴스 유형과 가용 영역에서 스팟 인스턴스를 요청하고 필요시 온디맨드 인스턴스도 사용할 수 있게 구성할 수 있는 EC2 서비스 기능이다.

지정한 **용량(target capacity)**을 만족하도록 인스턴스를 자동으로 선택하고, 최적의 비용이 드는 조합으로 유지한다.


| 구성 요소                             | 설명                                                                                                         |
| --------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| **Launch Specification**          | 어떤 인스턴스 유형을 사용할지, 어떤 AMI를 사용할지, 어떤 가용 영역(AZ)에 배포할지를 지정                                                     |
| **Target Capacity**               | 요청하려는 총 컴퓨팅 용량. 단위는 인스턴스 개수 또는 vCPU/메모리 기준으로 지정 가능                                                         |
| **Allocation Strategy**           | 어떤 기준으로 인스턴스를 선택할지 결정<br>- `lowestPrice` (기본값): 가장 저렴한 가격의 인스턴스를 선택<br>- `diversified`: 다양한 풀에 인스턴스를 분산 배포 |
| **On-Demand Allocation Strategy** | 온디맨드 인스턴스를 어떤 기준으로 선택할지 결정 (`lowestPrice` 또는 `prioritized`)                                                |
| **Spot Price**                    | 사용자가 지불할 의향이 있는 최대 금액. 요즘은 자동으로 최적 가격을 지정하는 경우가 많음                                                         |
| **IAM Role**                      | 스팟 플릿이 EC2 인스턴스를 시작/중지할 수 있도록 권한 부여                                                                        |
